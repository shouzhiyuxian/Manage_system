<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å®ä¹ ç”Ÿä¿¡æ¯ç®¡ç†</title>
    <!-- CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/index.css">
    <link rel="stylesheet" href="/static/css/right.css">
    <link rel="stylesheet" href="/static/css/my_information.css">
    <link rel="stylesheet" href="/static/css/stu_info.css">
    <link rel="stylesheet" href="/static/css/new_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<div class="main-left">
    <div class="sidebar-wrapper">
        <div class="sidebar-menu">
            {% if isadmin == '1' %}
            <div class="menu-group">
                <div class="menu-item">
                    <a href="/province_map" class="menu-link">
                        <i class="fas fa-house"></i>
                        <span class="menu-text">æ™ºèƒ½çœ‹æ¿</span>
                    </a>
                </div>
            </div>
            {% endif %}
            {% if isadmin == '1' %}
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#flush-collapseOne" aria-expanded="false"
                                aria-controls="flush-collapseOne" style="background-color: #2a3042; color: #ffffffbd;">
                            å®ä¹ ä¿¡æ¯ç®¡ç†
                        </button>
                    </h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
                         data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/stu_info"
                                                                                          style="color: #ffffffbd;">å®ä¹ ç”Ÿä¿¡æ¯</a>
                        </div>
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/work_info"
                                                                                          style="color: #ffffffbd;">å®ä¹ å•ä½ä¿¡æ¯</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#flush-collapseTwo" aria-expanded="false"
                                aria-controls="flush-collapseTwo" style="background-color: #2a3042; color: #ffffffbd;">
                            å®ä¹ è¿‡ç¨‹ç®¡ç†
                        </button>
                    </h2>
                    <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo"
                         data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/feedback_list"
                                                                                          style="color: #ffffffbd;">æ‚„æ‚„è¯</a>
                        </div>
                        {% if isadmin == '1' %}
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/signin_record"
                                                                                          style="color: #ffffffbd;">ç­¾åˆ°è®°å½•</a>
                        </div>
                        {% endif %}
                        {% if isadmin == '1' %}
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/admin_reports" style="color: #ffffffbd;">å®ä¹ å‘¨æŠ¥å®¡æ‰¹</a>
                        </div>
                        {% else %}
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/report" style="color: #ffffffbd;">å®ä¹ å‘¨æŠ¥</a>
                        </div>
                        {% endif %}

                    </div>
                </div>
            </div>
            {% endif %}
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#flush-collapseThree" aria-expanded="false"
                                aria-controls="flush-collapseThree"
                                style="background-color: #2a3042; color: #ffffffbd;">
                            ä¼˜ç§€å®ä¹ ç”Ÿç®¡ç†
                        </button>
                    </h2>
                    <div id="flush-collapseThree" class="accordion-collapse collapse"
                         aria-labelledby="flush-headingThree"
                         data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/excellent_practicer"
                                                                                          style="color: #ffffffbd;">ä¼˜ç§€å®ä¹ ç”Ÿç”³è¯·</a>
                        </div>
                        {% if isadmin == '1' %}
                        <div class="accordion-body" style="background-color: #2a3042;"><a
                                href="/excellent_stu_application" style="color: #ffffffbd;">ä¼˜ç§€å®ä¹ ç”Ÿå®¡æ‰¹</a></div>
                        <div class="accordion-body" style="background-color: #2a3042;"><a href="/excellent_stu_info"
                                                                                          style="color: #ffffffbd;">ä¼˜ç§€å®ä¹ ç”Ÿä¿¡æ¯</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="menu-group">
                <div class="menu-item">
                    <a href="/my_information" class="menu-link">
                        <i class="fas fa-user-cog"></i>
                        <span class="menu-text">ä¸ªäººä¿¡æ¯</span>
                    </a>
                </div>
                {% if isadmin == '1' %}
                <div class="menu-item">
                    <a href="/college_manage" class="menu-link">
                        <i class="fas fa-university"></i>
                        <span class="menu-text">å­¦é™¢ç®¡ç†</span>
                    </a>
                </div>
                {% endif %}
                <div class="menu-item">
                    <a href="/sign_in_calendar" class="menu-link highlight">
                        <i class="fas fa-map-pin"></i>
                        <span class="menu-text">ç«‹å³ç­¾åˆ°</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="main-right ps-4 pe-4">
     <div class="logo text-center mb-4" style="top: 0.5em">
        <img src="../static/img/logo.png" alt="logo" class="img-fluid" style="max-height: 88px">
    </div>
    <div class="header">
        <span>å®ä¹ ç”Ÿç®¡ç†ç³»ç»Ÿ</span>
    </div>
   <nav class="mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/index" class="text-decoration-none">é¦–é¡µ</a></li>
                <li class="breadcrumb-item active">å®ä¹ ç”Ÿä¿¡æ¯ç®¡ç†</li>
            </ol>
            <div class="user-status d-flex align-items-center flex-nowrap" style="padding-right: 24px;">
                <span class="text-muted text-nowrap me-2">æ¬¢è¿ï¼Œ{{ user_name }}ï¼</span>
                <a href="/login" class="btn btn-sm btn-outline-danger flex-shrink-0">é€€å‡ºç³»ç»Ÿ</a>
            </div>
        </div>
    </nav>
    <div class="content">
        <form id="form" method="post" class="mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form>
                        <div class="row g-4">
        <!-- ç¬¬ä¸€è¡Œ -->
        <div class="col-12">
            <div class="row g-4 align-items-center">
                <!-- å­¦å¹´ -->
                <div class="col-md-3">
                    <div class="row align-items-center g-2">
                        <div class="col-auto">
                            <label class="form-label mb-0">æ‰€å±å­¦å¹´</label>
                        </div>
                        <div class="col">
                            <select class="form-select">
                                <option selected>2023-2024</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- æ‰€å±å¹´çº§ -->
                <div class="col-md-3">
                    <div class="row align-items-center g-2">
                        <div class="col-auto">
                            <label class="form-label mb-0">æ‰€å±å¹´çº§</label>
                        </div>
                        <div class="col">
                            <select class="form-select" name="grade">
                                <option value="0">è¯·é€‰æ‹©å¹´çº§</option>
                                {% for grade in grades %}
                                <option value="{{ grade.value }}" {% if grade.selected %}selected{% endif %}>{{ grade.label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- é™¢ç³»é€‰æ‹© -->
                <div class="col-md-3">
                    <div class="row align-items-center g-2">
                        <div class="col-auto">
                            <label class="form-label mb-0">é€‰æ‹©é™¢ç³»</label>
                        </div>
                        <div class="col">
                            <select class="form-select" name="department" id="department">
                                <option value="0">è¯·é€‰æ‹©é™¢ç³»</option>
                                {% for dept in departments %}
                                <option value="{{ dept.id }}" {% if stu_info.department_name == dept.department_name %}selected{% endif %}>
                                    {{ dept.department_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒè¡Œ -->
        <div class="col-12">
            <div class="row g-4 align-items-center">
                <!-- æ‰€å±ä¸“ä¸š -->
                <div class="col-md-3">
                    <div class="row align-items-center g-2">
                        <div class="col-auto">
                            <label class="form-label mb-0">æ‰€å±ä¸“ä¸š</label>
                        </div>
                        <div class="col">
                            <select class="form-select" name="major" id="major">
                                <option value="0">è¯·é€‰æ‹©ä¸“ä¸š</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- æ‰€å±ç­çº§ -->
                <div class="col-md-3">
                    <div class="row align-items-center g-2">
                        <div class="col-auto">
                            <label class="form-label mb-0">æ‰€å±ç­çº§</label>
                        </div>
                        <div class="col">
                            <select class="form-select" name="class">
                                <option value="0">è¯·é€‰æ‹©ç­çº§</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- å­¦å·æœç´¢ -->
                <div class="col-md-3">
                    <div class="row align-items-center g-2">
                        <div class="col-auto">
                            <label class="form-label mb-0">å­¦å·æŸ¥è¯¢</label>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" placeholder="è¯·è¾“å…¥å­¦å·" name="stu_id">
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="col-md-3">
                    <div class="d-flex gap-3 justify-content-end">
                        <button type="submit" class="btn btn-outline-primary flex-shrink-0" style="position: absolute;
        left: 88%;
        top: 49%;">
                            <i class="bi bi-search me-2"></i>ç«‹å³æŸ¥è¯¢
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

                    </form>
                </div>
            </div>
        </form>
            <div class="stu_info" id="app">
                <table class="table">
                    <colgroup>
                      <col style="width: 100px">
                      <col style="width: 80px">
                      <col style="width: 70px">
                      <col style="width: 240px">
                      <col style="width: 150px">
                      <col style="width: 80px">
                      <col style="width: 100px">
                      <col style="width: 300px">
                    </colgroup>
                    <thead>
                    <tr>
                        <th scope="col">å­¦å·</th>
                        <th scope="col">å­¦ç”Ÿå§“å</th>
                        <th scope="col">å¹´çº§</th>
                        <th scope="col">é™¢ç³»</th>
                        <th scope="col">ä¸“ä¸š</th>
                        <th scope="col">æ‰€åœ¨ç­çº§</th>
                        <th scope="col">å•ä½åç§°</th>
                        <th scope="col">å®ä¹ å²—ä½</th>
                        <th scope="col">ä¸“ä¸šå²—ä½åŒ¹é…åº¦</th>
                        <th scope="col">å•ä½åœ°å€</th>
                        <th scope="col">æ“ä½œ</th>
                    </tr>
                    </thead>
                    <tbody style="font-size: 0.9em">
                    {% for user in users.items %}
                    {% if user %}
                    <tr>
                        <td>{{ user.stu_id }}</td>
                        <td>{{ stu_info.query.filter(stu_info.stu_id==user.stu_id).first().name }}</td>
                        <td>{{ stu_info.query.filter(stu_info.stu_id==user.stu_id).first().grade }}</td>
                        <td>{{ stu_info.query.filter(stu_info.stu_id==user.stu_id).first().department_name }}</td>
                        <td>{{ stu_info.query.filter(stu_info.stu_id==user.stu_id).first().major_name }}</td>
                        <td>{{ stu_info.query.filter(stu_info.stu_id==user.stu_id).first().class_id }}</td>
                        <td>{% for u in user.work_info %}{{ u.name }}{% endfor %}</td>
                        <td>{{ stu_info.query.filter(stu_info.stu_id==user.stu_id).first().internship_positions }}
                        {% if  stu_info.query.filter(stu_info.stu_id==user.stu_id).first().internship_positions  in hot_positions %}
                            <div class="hot-label">
                              <span class="flame">ğŸ”¥</span>
                              <span class="hot-text">HOT</span>
                            </div>
                        {% endif %}
                        </td>
                        {% if stu_info.query.filter(stu_info.stu_id==user.stu_id).first() %}
                        <td class="score-cell">
                            {{ "%0.2f" | format(stu_info.query.filter(stu_info.stu_id==user.stu_id).first().score | float) }}
                        </td>
                        {% else %}
                         <td class="score-cell">
                            0.00
                        </td>
                        {% endif %}
                        <td>{% for u in user.work_info %}{{ u.position }}{% endfor %}</td>
                        <td>
                            <button class="btn btn-outline-secondary fbtn" id="button-addon2"><a
                                    href="/add_stu_info?username={{ user.stu_id }}">ä¿®æ”¹ä¿¡æ¯</a></button>
                        </td>
                    </tr>
                    {% else %}
                    N/A
                    {% endif%}
                    {% endfor %}
                    </tbody>
                </table>
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        {% if users.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('stu_info', page=users.prev_num) }}">Previous</a>
                        </li>
                        {% endif %}
                        {% for page_num in users.iter_pages(left_edge=2, right_edge=2, left_current=3, right_current=3)
                        %}
                        {% if page_num %}
                        <li class="page-item {% if page_num == users.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('stu_info', page=page_num) }}">{{ page_num }}</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                        {% endif %}
                        {% endfor %}

                        {% if users.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('stu_info', page=users.next_num) }}">Next</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
    </div>
</div>

<script src="/static/js/vue-2.5.16.js"></script>
<script src="/static/js/nav.js"></script>
<script src="/static/js/bootstrap.bundle.min.js"></script>
<script src="/static/js/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#department').change(function () {
            var departmentId = $(this).val();
            if (departmentId) {
                $.ajax({
                    url: '/get_majors/' + departmentId,
                    method: 'GET',
                    success: function (data) {
                        var majors = data.majors;
                        var $majorSelect = $('#major');
                        $majorSelect.empty();
                        $majorSelect.append('<option value="0">æ‰€å±ä¸“ä¸š</option>');
                        $.each(majors, function (index, major) {
                            $majorSelect.append('<option value="' + major.id + '">' + major.major_name + '</option>');
                        });
                    }
                });
            } else {
                $('#major').empty();
                $('#major').append('<option value="0">æ‰€å±ä¸“ä¸š</option>');
            }
        });
    });
</script>
<!-- jQuery and JavaScript Bundle with Popper -->
<script>
    $(document).ready(function () {
        $('.score-cell').each(function () {
            const $cell = $(this);
            const score = parseFloat($cell.text().trim()) || 0;

            const text = score > 0.5 ? 'é«˜ç›¸å…³' : 'ä½ç›¸å…³';
            const colorClass = score > 0.5 ? 'relevance-high' : 'relevance-low';

            $cell.append(
                $('<span>')
                    .addClass('relevance ' + colorClass)
                    .text(text)
            );
        });
    });
</script>
</body>
</html>